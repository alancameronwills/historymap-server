// Azure Storage JavaScript Client Library 0.2.8-preview.14 
// Copyright (c) Microsoft and contributors. All rights reserved. 
require=function e(t,r,n){function s(a,i){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!i&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return s(r||e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({2:[function(e,t,r){var n=window.AzureStorage||{};n.generateDevelopmentStorageCredentials=function(e){var t="UseDevelopmentStorage=true;";return e&&(t+="DevelopmentStorageProxyUri="+e),t};var s=e("../lib/services/file/fileservice.browser");n.FileService=s,n.FileUtilities=e("../lib/services/file/fileutilities"),n.createFileService=function(e,t,r){return new s(e,t,r)},n.createFileServiceWithSas=function(e,t){return new s(null,null,e,t)};var o=e("../lib/common/common.browser"),a=o.StorageServiceClient,i=o.SharedKey;n.generateAccountSharedAccessSignature=function(e,t,r){var n=a.getStorageSettings(e,t);return new i(n._name,n._key).generateAccountSignedQueryString(r)},n.Constants=o.Constants,n.StorageUtilities=o.StorageUtilities,n.AccessCondition=o.AccessCondition,n.SR=o.SR,n.StorageServiceClient=a,n.Logger=o.Logger,n.WebResource=o.WebResource,n.Validate=o.validate,n.date=o.date,n.LinearRetryPolicyFilter=o.LinearRetryPolicyFilter,n.ExponentialRetryPolicyFilter=o.ExponentialRetryPolicyFilter,n.RetryPolicyFilter=o.RetryPolicyFilter,window.AzureStorage=n},{"../lib/common/common.browser":5,"../lib/services/file/fileservice.browser":50,"../lib/services/file/fileutilities":52}],50:[function(e,t,r){var n=e("./fileservice.core"),s=e("./../../common/common.browser"),o=e("extend"),a=s.util,i=s.BrowserFileReadStream,l=s.SpeedSummary,u=s.validate,c=s.ChunkStreamWithStream;n.prototype.createFileFromBrowserFile=function(e,t,r,n,s,d){var p;a.normalizeArgs(s,d,function(e,t){p=e,d=t}),u.validateArgs("createFileFromBrowserFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.browserFileIsValid(n),s.shareNameIsValid(e),s.callback(d)});var h=o(!0,{},p);h.speedSummary=h.speedSummary||new l(r);var f=this;return this.createFile(e,t,r,n.size,h,function(s){if(s)d(s);else{var o=new i(n),a=new c(o,{calcContentMd5:h.storeFileContentMD5});f._createFileFromChunkStream(e,t,r,a,n.size,h,d)}}),h.speedSummary},t.exports=n},{"./../../common/common.browser":5,"./fileservice.core":51,extend:158}],51:[function(e,t,r){(function(r){var n=e("querystring"),s=e("url"),o=e("util"),a=e("underscore"),i=e("extend"),l=e("path"),u=e("./../../common/common.core"),c=e("./../../common/md5-wrapper"),d=u.util,p=u.SR,h=u.validate,f=u.SpeedSummary,g=u.StorageServiceClient,m=u.WebResource,S=u.Constants,y=S.FileConstants,R=S.HeaderConstants,E=S.HttpConstants,v=S.QueryStringConstants,A=u.BatchOperation,T=(f=u.SpeedSummary,u.ChunkAllocator),I=u.ChunkStream,N=u.ChunkStreamWithStream,_=e("./internal/filerangestream"),w=e("./models/shareresult"),C=e("./models/directoryresult"),O=e("./models/fileresult"),F=u.AclResult,b=e("../../common/errors/errors"),P=b.ArgumentNullError,M=b.ArgumentError;function H(e,t,r,n,s){var o=g.getStorageSettings(e,t,r,n,s);H.super_.call(this,o._name,o._key,o._fileEndpoint,o._usePathStyleUri,o._sasToken),this.defaultEnableReuseSocket=S.DEFAULT_ENABLE_REUSE_SOCKET,this.singleFileThresholdInBytes=y.DEFAULT_SINGLE_FILE_GET_THRESHOLD_IN_BYTES,this.parallelOperationThreadCount=S.DEFAULT_PARALLEL_OPERATION_THREAD_COUNT}function D(e,t,r,n){var s=function(e){return e&&!n&&(e=(e=(e=(e=encodeURIComponent(e)).replace(/%2F/g,"/")).replace(/%5C/g,"/")).replace(/\+/g,"%20")),e},o=e;return t&&("/"!==t[0]&&(o+="/"),o+=s(t)),r&&("/"!==o[o.length-1]&&(o+="/"),o+=s(r)),l.normalize(o).replace(/\\/g,"/")}o.inherits(H,g),H.prototype.getServiceProperties=function(e,t){return this.getAccountServiceProperties(e,t)},H.prototype.setServiceProperties=function(e,t,r){return this.setAccountServiceProperties(e,t,r)},H.prototype.listSharesSegmented=function(e,t,r){this.listSharesSegmentedWithPrefix(null,e,t,r)},H.prototype.listSharesSegmentedWithPrefix=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("listShares",function(e){e.callback(n)});var o=i(!0,{},s),l=m.get().withQueryOption(v.COMP,"list").withQueryOption(v.MAX_RESULTS,o.maxResults).withQueryOption(v.INCLUDE,o.include);d.objectIsNull(t)||l.withQueryOption(v.MARKER,t.nextMarker),l.withQueryOption(v.PREFIX,e);this.performRequest(l,null,o,function(e,t){if(e.listSharesResult=null,!e.error){e.listSharesResult={entries:null,continuationToken:null},e.listSharesResult.entries=[];var r=[];e.response.body.EnumerationResults.Shares&&e.response.body.EnumerationResults.Shares.Share&&(r=e.response.body.EnumerationResults.Shares.Share,a.isArray(r)||(r=[r])),r.forEach(function(t){var r=w.parse(t);e.listSharesResult.entries.push(r)}),e.response.body.EnumerationResults.NextMarker&&(e.listSharesResult.continuationToken={nextMarker:null,targetLocation:null},e.listSharesResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listSharesResult.continuationToken.targetLocation=e.targetLocation)}t(e,function(e){n(e.error,e.listSharesResult,e.response)})})},H.prototype.doesShareExist=function(e,t,r){this._doesShareExist(e,!1,t,r)},H.prototype.createShare=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("createShare",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.shareQuotaIsValid(n.quota),t.callback(r)});var s=i(!0,{},n),o=m.put(e).withQueryOption(v.RESTYPE,"share").withHeader(R.SHARE_QUOTA,s.quota);o.addOptionalMetadataHeaders(s.metadata);this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new w(e),t.shareResult.getPropertiesFromHeaders(t.response.headers),s.metadata&&(t.shareResult.metadata=s.metadata));n(t,function(e){r(e.error,e.shareResult,e.response)})})},H.prototype.createShareSnapshot=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("createShareSnapshot",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=i(!0,{},n),o=m.put(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.COMP,v.SNAPSHOT);o.addOptionalMetadataHeaders(s.metadata);this.performRequest(o,null,s,function(e,t){e.snapshotId=null,e.error||(e.snapshotId=e.response.headers[R.SNAPSHOT]);t(e,function(e){r(e.error,e.snapshotId,e.response)})})},H.prototype.createShareIfNotExists=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("createShareIfNotExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=i(!0,{},n);delete s.shareSnapshotId;var o=this;o._doesShareExist(e,!0,s,function(t,n,a){var i=n.exists;n.created=!1,delete n.exists,t?r(t,n,a):i?(a.isSuccessful=!0,r(t,n,a)):o.createShare(e,s,function(e,t,n){e?e&&e.statusCode===E.HttpResponseCodes.Conflict&&e.code===S.FileErrorCodeStrings.SHARE_ALREADY_EXISTS&&(e=null,n.isSuccessful=!0):t.created=!0,r(e,t,n)})})},H.prototype.getShareProperties=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("getShareProperties",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=i(!0,{},n),o=m.head(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.SHARE_SNAPSHOT,s.shareSnapshotId),a=this;this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new w(e),t.shareResult.metadata=a.parseMetadataHeaders(t.response.headers),t.shareResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){r(e.error,e.shareResult,e.response)})})},H.prototype.setShareProperties=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("setShareProperties",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.shareQuotaIsValid(s.quota),t.callback(n)});var o=i(!0,t,s),a=D(e),l=m.put(a).withQueryOption(v.RESTYPE,"share").withQueryOption(v.COMP,"properties").withHeader(R.SHARE_QUOTA,o.quota);O.setProperties(l,o);this.performRequest(l,null,o,function(t,r){t.shareResult=null,t.error||(t.shareResult=new w(e),t.shareResult.getPropertiesFromHeaders(t.response.headers));r(t,function(e){n(e.error,e.shareResult,e.response)})})},H.prototype.getShareStats=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("getShareStats",function(e){e.callback(r)});var s=i(!0,{},n),o=D(e),a=m.get(o).withQueryOption(v.RESTYPE,"share").withQueryOption(v.COMP,"stats");this.performRequest(a,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=w.parse(t.response.body,e),t.shareResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){r(e.error,e.shareResult,e.response)})})},H.prototype.getShareMetadata=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("getShareMetadata",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=i(!0,{},n),o=m.head(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.COMP,"metadata").withQueryOption(v.SHARE_SNAPSHOT,s.shareSnapshotId),a=this;this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new w(e),t.shareResult.metadata=a.parseMetadataHeaders(t.response.headers),t.shareResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){r(e.error,e.shareResult,e.response)})})},H.prototype.setShareMetadata=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("setShareMetadata",function(r){r.string(e,"share"),r.object(t,"metadata"),r.shareNameIsValid(e),r.callback(n)});var o=i(!0,{},s),a=m.put(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.COMP,"metadata");a.addOptionalMetadataHeaders(t);this.performRequest(a,null,o,function(t,r){t.shareResult=null,t.error||(t.shareResult=new w(e),t.shareResult.getPropertiesFromHeaders(t.response.headers));r(t,function(e){n(e.error,e.shareResult,e.response)})})},H.prototype.getShareAcl=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("getShareAcl",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=i(!0,{},n),o=m.get(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.COMP,"acl");s.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new w(e),t.shareResult.getPropertiesFromHeaders(t.response.headers),t.shareResult.signedIdentifiers=F.parse(t.response.body));n(t,function(e){r(e.error,e.shareResult,e.response)})})},H.prototype.setShareAcl=function(e,t,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("setShareAcl",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(s)});var l=i(!0,{},o),u=null;if(t){if(a.isArray(t))throw new TypeError(p.INVALID_SIGNED_IDENTIFIERS);u=F.serialize(t)}var c=m.put(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.COMP,"acl").withHeader(R.CONTENT_LENGTH,d.objectIsNull(u)?0:r.byteLength(u)).withBody(u);this.performRequest(c,c.body,l,function(r,n){r.shareResult=null,r.error||(r.shareResult=new w(e),r.shareResult.getPropertiesFromHeaders(r.response.headers),t&&(r.shareResult.signedIdentifiers=t));n(r,function(e){s(e.error,e.shareResult,e.response)})})},H.prototype.deleteShare=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("deleteShare",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=i(!0,{},n);if(!d.objectIsNull(s.shareSnapshotId)&&!d.objectIsNull(s.deleteSnapshots))throw new M("options",p.INVALID_DELETE_SNAPSHOT_OPTION);var o=m.del(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.SHARE_SNAPSHOT,s.shareSnapshotId).withHeader(R.DELETE_SNAPSHOT,s.deleteSnapshots);this.performRequest(o,null,s,function(e,t){t(e,function(e){r(e.error,e.response)})})},H.prototype.deleteShareIfExists=function(e,t,r){var n;d.normalizeArgs(t,r,function(e,t){n=e,r=t}),h.validateArgs("deleteShareIfExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=i(!0,{},n),o=this;o._doesShareExist(e,!0,s,function(t,n,a){t?r(t,n.exists,a):n.exists?o.deleteShare(e,s,function(e,t){var n;e?e&&e.statuscode===E.HttpResponseCodes.NotFound&&e.code===S.FileErrorCodeStrings.SHARE_NOT_FOUND&&(n=!1,e=null,t.isSuccessful=!0):n=!0,r(e,n,t)}):(a.isSuccessful=!0,r(t,!1,a))})},H.prototype.doesDirectoryExist=function(e,t,r,n){this._doesDirectoryExist(e,t,!1,r,n)},H.prototype.createDirectory=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("createDirectory",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=i(!0,{},s),a=m.put(D(e,t)).withQueryOption(v.RESTYPE,"directory");a.addOptionalMetadataHeaders(o.metadata);this.performRequest(a,null,o,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new C(t),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){n(e.error,e.directoryResult,e.response)})})},H.prototype.createDirectoryIfNotExists=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("createDirectoryIfNotExists",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=i(!0,{},s);delete o.shareSnapshotId;var a=this;a._doesDirectoryExist(e,t,!0,o,function(r,s,i){var l=s.exists;s.created=!1,delete s.exists,r?n(r,s,i):l?(i.isSuccessful=!0,n(r,s,i)):a.createDirectory(e,t,o,function(e,t,r){e?e&&e.statusCode===E.HttpResponseCodes.Conflict&&e.code===S.StorageErrorCodeStrings.RESOURCE_ALREADY_EXISTS&&(e=null,r.isSuccessful=!0):t.created=!0,n(e,t,r)})})},H.prototype.getDirectoryProperties=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("getDirectoryProperties",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=i(!0,{},s),a=m.head(D(e,t)).withQueryOption(v.RESTYPE,"directory").withQueryOption(v.SHARE_SNAPSHOT,o.shareSnapshotId),l=this;this.performRequest(a,null,o,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new C(t),e.directoryResult.metadata=l.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){n(e.error,e.directoryResult,e.response)})})},H.prototype.deleteDirectory=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("deleteDirectory",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=i(!0,{},s),a=m.del(D(e,t)).withQueryOption(v.RESTYPE,"directory");this.performRequest(a,null,o,function(e,t){t(e,function(e){n(e.error,e.response)})})},H.prototype.deleteDirectoryIfExists=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("deleteDirectoryIfExists",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=i(!0,{},s);delete o.shareSnapshotId;var a=this;a._doesDirectoryExist(e,t,!0,o,function(r,s,i){r?n(r,s.exists,i):s.exists?a.deleteDirectory(e,t,o,function(e,t){var r;e?e&&e.statuscode===E.HttpResponseCodes.NotFound&&e.code===S.StorageErrorCodeStrings.RESOURCE_NOT_FOUND&&(r=!1,e=null,t.isSuccessful=!0):r=!0,n(e,r,t)}):(i.isSuccessful=!0,n(r,!1,i))})},H.prototype.listFilesAndDirectoriesSegmented=function(e,t,r,n,s){this.listFilesAndDirectoriesSegmentedWithPrefix(e,t,null,r,n,s)},H.prototype.listFilesAndDirectoriesSegmentedWithPrefix=function(e,t,r,n,s,o){var l;d.normalizeArgs(s,o,function(e,t){l=e,o=t}),h.validateArgs("listFilesSegmented",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(o)});var u=i(!0,{},l),c=m.get(D(e,t)).withQueryOption(v.RESTYPE,"directory").withQueryOption(v.COMP,"list").withQueryOption(v.MAX_RESULTS,u.maxResults).withQueryOption(v.SHARE_SNAPSHOT,u.shareSnapshotId);d.objectIsNull(n)||c.withQueryOption(v.MARKER,n.nextMarker),c.withQueryOption(v.PREFIX,r);this.performRequest(c,null,u,function(e,t){if(e.listResult=null,!e.error){e.listResult={entries:null,continuationToken:null},e.listResult.entries={},e.listResult.entries.files=[],e.listResult.entries.directories=[];var r=[],n=[];e.response.body.EnumerationResults.Entries.File&&(r=e.response.body.EnumerationResults.Entries.File,a.isArray(r)||(r=[r])),r.forEach(function(t){var r=O.parse(t);e.listResult.entries.files.push(r)}),e.response.body.EnumerationResults.Entries.Directory&&(n=e.response.body.EnumerationResults.Entries.Directory,a.isArray(n)||(n=[n])),n.forEach(function(t){var r=C.parse(t);e.listResult.entries.directories.push(r)}),e.response.body.EnumerationResults.NextMarker&&(e.listResult.continuationToken={nextMarker:null,targetLocation:null},e.listResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listResult.continuationToken.targetLocation=e.targetLocation)}t(e,function(e){o(e.error,e.listResult,e.response)})})},H.prototype.getDirectoryMetadata=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("getDirectoryMetadata",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=i(!0,{},s),a=D(e,t),l=m.head(a).withQueryOption(v.RESTYPE,"directory").withQueryOption(v.COMP,"metadata").withQueryOption(v.SHARE_SNAPSHOT,o.shareSnapshotId),u=this;this.performRequest(l,null,o,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new C(t),e.directoryResult.metadata=u.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){n(e.error,e.directoryResult,e.response)})})},H.prototype.setDirectoryMetadata=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("setDirectoryMetadata",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.shareNameIsValid(e),n.object(r,"metadata"),n.callback(s)});var a=i(!0,{},o),l=D(e,t),u=m.put(l).withQueryOption(v.RESTYPE,"directory").withQueryOption(v.COMP,"metadata");u.addOptionalMetadataHeaders(r);this.performRequest(u,null,a,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new C(t),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){s(e.error,e.directoryResult,e.response)})})},H.prototype.generateSharedAccessSignature=function(e,t,r,n,s){if(!this.storageCredentials||!this.storageCredentials.generateSignedQueryString)throw new Error(p.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY);h.validateArgs("generateSharedAccessSignature",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.object(n,"sharedAccessPolicy")});var o=y.ResourceTypes.SHARE;r?(h.validateArgs("generateSharedAccessSignature",function(e){e.stringAllowEmpty(t,"directory"),e.string(r,"file")}),o=y.ResourceTypes.FILE):t="",n.AccessPolicy&&(d.objectIsNull(n.AccessPolicy.Start)||(a.isDate(n.AccessPolicy.Start)||(n.AccessPolicy.Start=new Date(n.AccessPolicy.Start)),n.AccessPolicy.Start=d.truncatedISO8061Date(n.AccessPolicy.Start)),d.objectIsNull(n.AccessPolicy.Expiry)||(a.isDate(n.AccessPolicy.Expiry)||(n.AccessPolicy.Expiry=new Date(n.AccessPolicy.Expiry)),n.AccessPolicy.Expiry=d.truncatedISO8061Date(n.AccessPolicy.Expiry)));var i=D(e,t,r,!0);return this.storageCredentials.generateSignedQueryString(S.ServiceType.File,i,n,null,{headers:s,resourceType:o})},H.prototype.getUrl=function(e,t,r,o,a,i){var l;h.validateArgs("getUrl",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e)}),l=d.objectIsNull(a)||!1!==a?this.host.primaryHost:this.host.secondaryHost,(l=d.trimPortFromUri(l))&&l.lastIndexOf("/")!==l.length-1&&(l+="/");var u=D(e,t,r),c=n.parse(o);return i&&(c[v.SHARE_SNAPSHOT]=i),s.resolve(l,s.format({pathname:this._getPath(u),query:c}))},H.prototype.getFileProperties=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("getFileProperties",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var a=i(!0,{},o),l=D(e,t,r),u=m.head(l).withQueryOption(v.SHARE_SNAPSHOT,a.shareSnapshotId),c=this;this.performRequest(u,null,a,function(n,o){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.metadata=c.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0));o(n,function(e){s(e.error,e.fileResult,e.response)})})},H.prototype.getFileMetadata=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("getFileMetadata",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var a=i(!0,{},o),l=D(e,t,r),u=m.head(l).withQueryOption(v.COMP,"metadata").withQueryOption(v.SHARE_SNAPSHOT,a.shareSnapshotId),c=this;this.performRequest(u,null,a,function(n,o){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.metadata=c.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers));o(n,function(e){s(e.error,e.fileResult,e.response)})})},H.prototype.setFileProperties=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("setFileProperties",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var l=i(!0,{contentSettings:n,contentLength:n.contentLength},a),u=D(e,t,r),c=m.put(u).withQueryOption(v.COMP,"properties");O.setProperties(c,l);this.performRequest(c,null,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){o(e.error,e.fileResult,e.response)})})},H.prototype.setFileMetadata=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("setFileMetadata",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.object(n,"metadata"),s.callback(o)});var l=i(!0,{},a),u=D(e,t,r),c=m.put(u).withQueryOption(v.COMP,"metadata");c.addOptionalMetadataHeaders(n);this.performRequest(c,null,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){o(e.error,e.fileResult,e.response)})})},H.prototype.resizeFile=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("resizeFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.value(n),s.callback(o)});var l=i(!0,{},a),u=D(e,t,r),c=m.put(u).withQueryOption(v.COMP,"properties");c.withHeader(R.FILE_CONTENT_LENGTH,n);this.performRequest(c,null,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){o(e.error,e.fileResult,e.response)})})},H.prototype.doesFileExist=function(e,t,r,n,s){this._doesFileExist(e,t,r,!1,n,s)},H.prototype.createFile=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("createFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.value(n),s.callback(o)});var l=D(e,t,r),u=i(!0,{},a),c=m.put(l).withHeader(R.TYPE,"file").withHeader(R.FILE_CONTENT_LENGTH,n);O.setProperties(c,u);this.performRequest(c,null,u,function(n,s){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){o(e.error,e.fileResult,e.response)})})},H.prototype.deleteFile=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("deleteFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var a=i(!0,{},o),l=D(e,t,r),u=m.del(l);this.performRequest(u,null,a,function(e,t){t(e,function(e){s(e.error,e.response)})})},H.prototype.deleteFileIfExists=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("deleteFileIfExists",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var a=i(!0,{},o);delete a.shareSnapshotId;var l=this;l._doesFileExist(e,t,r,!0,a,function(n,o,i){n?s(n,o.exists,i):o.exists?l.deleteFile(e,t,r,a,function(e,t){var r;e?e&&e.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&e.code===S.FileErrorCodeStrings.FILE_NOT_FOUND&&(r=!1,e=null,t.isSuccessful=!0):r=!0,s(e,r,t)}):(i.isSuccessful=!0,s(n,!1,i))})},H.prototype.getFileToText=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("getFileToText",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var a=i(!0,{},o),l=D(e,t,r),u=m.get(l).withQueryOption(v.SHARE_SNAPSHOT,a.shareSnapshotId).withRawResponse();O.setHeaders(u,a),this._setRangeContentMD5Header(u,a);var c=this;this.performRequest(u,null,a,function(n,o){n.text=null,n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0),n.fileResult.metadata=c.parseMetadataHeaders(n.response.headers),n.text=n.response.body,c._validateLengthAndMD5(a,n));o(n,function(e){s(e.error,e.text,e.fileResult,e.response)})})},H.prototype.createReadStream=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("createReadStream",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e)});var a=i(!0,{},o),l=new I(a);return this.getFileToStream(e,t,r,l,a,function(e,t,r){e&&l.emit("error",e),s&&s(e,t,r)}),l},H.prototype.getFileToStream=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),a.speedSummary=a.speedSummary||new f(r),h.validateArgs("getFileToStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(o)});var l=i(!0,{},a),u={timeoutIntervalInMs:l.timeoutIntervalInMs,clientRequestTimeoutInMs:l.clientRequestTimeoutInMs,accessConditions:l.accessConditions,shareSnapshotId:l.shareSnapshotId};if(l.skipSizeCheck)this._getFileToStream(e,t,r,n,l,o);else{var c=this;this.getFileProperties(e,t,r,u,function(s,a){if(s)o(s);else{var i;if(l.rangeStart){var u=a.contentLength-1;i=(l.rangeEnd?Math.min(l.rangeEnd,u):u)-l.rangeStart+1}else i=a.contentLength;l.speedSummary.totalSize=i,i>c.singleFileThresholdInBytes?(d.setObjectInnerPropertyValue(l,["contentSettings","contentMD5"],d.tryGetValueChain(a,["contentSettings","contentMD5"],null)),c._getFileToRangeStream(e,t,r,n,l,o)):c._getFileToStream(e,t,r,n,l,o)}})}return l.speedSummary},H.prototype.listRanges=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("listRanges",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var l=D(e,t,r),u=i(!0,{},o),c=m.get(l).withQueryOption(v.COMP,"rangelist").withQueryOption(v.SHARE_SNAPSHOT,u.shareSnapshotId);O.setHeaders(c,u);this.performRequest(c,null,u,function(e,t){if(e.ranges=null,!e.error){e.ranges=[];var r=[];e.response.body.Ranges.Range&&(r=e.response.body.Ranges.Range,a.isArray(r)||(r=[r])),r.forEach(function(t){var r={start:parseInt(t.Start,10),end:parseInt(t.End,10)};e.ranges.push(r)})}t(e,function(e){s(e.error,e.ranges,e.response)})})},H.prototype.clearRange=function(e,t,r,n,s,o,a){var l;d.normalizeArgs(o,a,function(e,t){l=e,a=t}),h.validateArgs("clearRange",function(o){o.string(e,"share"),o.stringAllowEmpty(t,"directory"),o.string(r,"file"),o.shareNameIsValid(e),o.value(n),o.value(s),o.callback(a)});var u=i(!0,{},l),c=this._updateFilesImpl(e,t,r,n,s,y.RangeWriteOptions.CLEAR,u);this.performRequest(c,null,u,function(n,s){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){a(e.error,e.fileResult,e.response)})})},H.prototype.createRangesFromStream=function(e,t,r,n,s,o,a,l){var u;d.normalizeArgs(a,l,function(e,t){u=e,l=t}),h.validateArgs("createRangesFromStream",function(a){a.string(e,"share"),a.stringAllowEmpty(t,"directory"),a.string(r,"file"),a.object(n,"readStream"),a.shareNameIsValid(e),a.value(s),a.value(o),a.callback(l)});var c=i(!0,{},u),f=d.objectIsNull(c.transactionalContentMD5)&&!0===c.useTransactionalMD5,g=o-s+1;if(g>y.MAX_UPDATE_FILE_SIZE)throw new Error(p.INVALID_FILE_RANGE_FOR_UPDATE);var m=this;f?d.calculateMD5(n,g,c,function(n,a){c.transactionalContentMD5=a,m._createRanges(e,t,r,n,null,s,o,c,l)}):m._createRanges(e,t,r,null,n,s,o,c,l)},H.prototype.createFileFromText=function(e,t,n,s,o,a){var l;d.normalizeArgs(o,a,function(e,t){l=e,a=t}),h.validateArgs("createFileFromText",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.string(n,"file"),r.exists(s,"text"),r.shareNameIsValid(e),r.callback(a)});var u=i(!0,{},l),c=r.isBuffer(s)?s.length:r.byteLength(s);if(c>y.MAX_UPDATE_FILE_SIZE)throw new Error(p.INVALID_FILE_LENGTH);u.storeFileContentMD5&&d.objectIsNull(d.tryGetValueChain(u,["contentSettings","contentMD5"],null))&&d.setObjectInnerPropertyValue(u,["contentSettings","contentMD5"],d.getContentMd5(s));var f=this;this.createFile(e,t,n,c,u,function(r){r?a(r):f._createRanges(e,t,n,s,null,0,c-1,u,a)})},H.prototype.createFileFromStream=function(e,t,r,n,s,o,a){var l;d.normalizeArgs(o,a,function(e,t){l=e,a=t}),h.validateArgs("createFileFromStream",function(o){o.string(e,"share"),o.stringAllowEmpty(t,"directory"),o.string(r,"file"),o.object(n,"stream"),o.value(s,"streamLength"),o.shareNameIsValid(e),o.callback(a)});var u=i(!0,{},l);u.speedSummary=u.speedSummary||new f(r),n.pause();var c=this;return this.createFile(e,t,r,s,u,function(o){if(o)a(o);else{var i=new N(n,{calcContentMd5:u.storeFileContentMD5});c._createFileFromChunkStream(e,t,r,i,s,u,a)}}),u.speedSummary},H.prototype.createWriteStreamToExistingFile=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("createWriteStreamToExistingFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e)});var a=i(!0,{},o),l=new I({calcContentMd5:a.storeFileContentMD5});return this._createFileFromChunkStream(e,t,r,l,null,a,function(e,t,r){e&&l.emit("error",e),s&&s(e,t,r)}),l},H.prototype.createWriteStreamToNewFile=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("createWriteStreamToNewFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.value(n,"length"),s.shareNameIsValid(e)});var l=i(!0,{},a),u=new I({calcContentMd5:l.storeFileContentMD5});u.pause();var c=this;return this.createFile(e,t,r,n,l,function(n){n?(u.emit("error",n),o(n)):(u.resume(),c._createFileFromChunkStream(e,t,r,u,null,l,function(e,t,r){e&&u.emit("error",e),o&&o(e,t,r)}))}),u},H.prototype.startCopyFile=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("startCopyFile",function(e){e.string(t,"targetShare"),e.stringAllowEmpty(r,"targetDirectory"),e.string(n,"targetFile"),e.shareNameIsValid(t),e.callback(o)});var l=D(t,r,n),u=i(!0,{},a),c=m.put(l).withHeader(R.COPY_SOURCE,e).addOptionalMetadataHeaders(u.metadata);this.performRequest(c,null,u,function(e,s){e.fileResult=null,e.error||(e.fileResult=new O(t,r,n),e.fileResult.getPropertiesFromHeaders(e.response.headers,!0),u.metadata&&(e.fileResult.metadata=u.metadata));s(e,function(e){o(e.error,e.fileResult,e.response)})})},H.prototype.abortCopyFile=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("abortCopyFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var l=D(e,t,r),u=i(!0,{},a),c=m.put(l).withQueryOption(v.COPY_ID,n).withQueryOption(v.COMP,"copy").withHeader(R.COPY_ACTION,"abort");this.performRequest(c,null,u,function(e,t){t(e,function(e){o(e.error,e.response)})})},H.prototype._createRanges=function(e,t,r,n,s,o,a,i,l){var u=this._updateFilesImpl(e,t,r,o,a,y.RangeWriteOptions.UPDATE,i);!d.objectIsNull(n)&&d.objectIsNull(i.transactionalContentMD5)&&!0===i.useTransactionalMD5&&u.withHeader(R.CONTENT_MD5,d.getContentMd5(n));var c=function(n,s){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){l(e.error,e.fileResult,e.response)})};d.objectIsNull(n)?this.performRequestOutputStream(u,s,i,c):this.performRequest(u,n,i,c)},H.prototype._createFileFromChunkStream=function(e,t,r,n,s,a,l){this.logger.debug(o.format("_createFileFromChunkStream for file %s",r));var u="_createRanges",c=y.DEFAULT_WRITE_SIZE_IN_BYTES,h=d.tryGetValueChain(a,["contentSettings","contentMD5"],null);this._setOperationExpiryTime(a);var g=a.speedSummary||new f;g.totalSize=s;var m=a.parallelOperationThreadCount||this.parallelOperationThreadCount,S=new T(c,m,{logger:this.logger});n._stream&&n._stream.setMemoryAllocator&&n._stream.setMemoryAllocator(S);var R=new A(u,{logger:this.logger,enableReuseSocket:this.defaultEnableReuseSocket});R.setConcurrency(m);var E={timeoutIntervalInMs:a.timeoutIntervalInMs,clientRequestTimeoutInMs:a.clientRequestTimeoutInMs,operationExpiryTime:a.operationExpiryTime},v=this;return n.on("data",function(s,i){var l=null,h=!1,f=g.getAutoIncrementFunction(s.length);if(s.length>c)throw new Error(o.format(p.EXCEEDED_SIZE_LIMITATION,c,s.length));if(a.useTransactionalMD5){var m=d.getContentMd5(s);E.transactionalContentMD5=m}d.isBufferAllZero(s)?(v.logger.debug(o.format("Skip upload data from %s bytes to %s bytes to file %s",i.start,i.end,r)),g.increment(s.length)):l=new A.RestOperation(v,u,e,t,r,s,null,i.start,i.end,E,function(e){e?(v.logger.debug(o.format("Stop downloading data as error happens. Error: %s",o.inspect(e))),n.stop()):f(),S.releaseBuffer(s),s=null}),l&&(h=R.addOperation(l),l=null,h&&(v.logger.debug("file stream paused"),n.pause()))}),n.on("end",function(){v.logger.debug(o.format("File read stream ended for file %s",r)),R.enableComplete()}),R.on("drain",function(){v.logger.debug("File stream resume"),n.resume()}),R.on("end",function(s){if(v.logger.debug("batch operations commited"),s)l(s);else{h?a.contentSettings.contentMD5=h:a.storeFileContentMD5&&d.setObjectInnerPropertyValue(a,["contentSettings","contentMD5"],n.getContentMd5("base64"));var o=i(!1,a.contentSettings,{contentLength:a.streamLength});v.setFileProperties(e,t,r,o,function(e,t,r){n.finish(),l(e,t,r)})}}),g},H.prototype._getFileToStream=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("_getFileToStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(o)});var l=i(!0,{},a),u=D(e,t,r),c=m.get(u).withQueryOption(v.SHARE_SNAPSHOT,l.shareSnapshotId).withRawResponse();O.setHeaders(c,l),this._setRangeContentMD5Header(c,l);var p=this;this.performRequestInputStream(c,null,n,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new O(e,t,r),n.fileResult.metadata=p.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0),p._validateLengthAndMD5(l,n));s(n,function(e){o(e.error,e.fileResult,e.response)})})},H.prototype._getFileToRangeStream=function(e,t,r,n,s,a){var i;d.normalizeArgs(s,a,function(e,t){i=e,a=t}),h.validateArgs("_getFileToRangeStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(a)});var l=i.speedSummary||new f(r),u=i.parallelOperationThreadCount||this.parallelOperationThreadCount,p=new A("getfile",{callbackInOrder:!0,logger:this.logger,enableReuseSocket:this.defaultEnableReuseSocket});p.setConcurrency(u);var g=new _(this,e,t,r,i),m=this,S=null;!i.disableContentMD5Validation&&(S=(new c).createMd5Hash());var y=null,R=null;g.on("range",function(s){l.totalSize||(l.totalSize=g.rangeSize);var a={rangeStart:s.start,rangeEnd:s.end,responseEncoding:null},u=s.size;if(a.shareSnapshotId=i.shareSnapshotId,a.timeoutIntervalInMs=i.timeoutIntervalInMs,a.clientRequestTimeoutInMs=i.clientRequestTimeoutInMs,a.useTransactionalMD5=i.useTransactionalMD5,0!==s.dataSize){if(!(s.start>s.end)){var c=new A.RestOperation(m,"getFileToText",e,t,r,a,function(e,t,r,s){if(e)m.logger.debug(o.format("Stop downloading data as error happens. Error: %s",o.inspect(e))),g.stop();else{u!==t.length&&m.logger.warn(o.format("Request %s bytes, but server returns %s bytes",u,t.length)),y||(y=r),R||(R=s);var a=l.getAutoIncrementFunction(t.length);n.write(t,a)||(m.logger.debug("Write stream is full and pause batch operation"),p.pause()),S&&S.update(t),t=null}});p.addOperation(c)&&(m.logger.debug("Pause range stream"),g.pause())}}else{var h=l.getAutoIncrementFunction(u),f=new A.CommonOperation(A.noOperation,function(e){if(!e){var t=d.writeZerosToStream(n,u,S,h);m.logger.debug(o.format("Write %s bytes Zero from %s to %s",u,s.start,s.end)),t||(m.logger.debug("Write stream is full and pause batch operation"),p.pause())}});p.addOperation(f)}}),g.on("end",function(){m.logger.debug("Range stream has ended."),p.enableComplete()}),p.on("drain",function(){m.logger.debug("Resume range stream"),g.resume()}),n.on("drain",function(){m.logger.debug("Resume batch operations"),p.resume()}),p.on("end",function(e){m.logger.debug("Download completed!"),e?a(e):n.end(function(){m.logger.debug("Write stream has ended"),y||(y={}),d.setObjectInnerPropertyValue(y,["contentSettings","contentMD5"],d.tryGetValueChain(i,["contentSettings","contentMD5"],null)),y.clientSideContentMD5=null,S&&(y.clientSideContentMD5=S.digest("base64")),a(e,y,R)})});var E={timeoutIntervalInMs:i.timeoutIntervalInMs,clientRequestTimeoutInMs:i.clientRequestTimeoutInMs};return g.list(E),l},H.prototype._setRangeContentMD5Header=function(e,t){if(!d.objectIsNull(t.rangeStart)&&t.useTransactionalMD5){if(d.objectIsNull(t.rangeEnd))throw new P(o.format(p.ARGUMENT_NULL_OR_EMPTY,t.rangeEndHeader));if(parseInt(t.rangeEnd,10)-parseInt(t.rangeStart,10)+1>y.MAX_RANGE_GET_SIZE_WITH_MD5)throw new Error(p.INVALID_RANGE_FOR_MD5);e.withHeader(R.RANGE_GET_CONTENT_MD5,"true")}},H.prototype._updateFilesImpl=function(e,t,r,n,s,o,a){var i=D(e,t,r),l=m.put(i).withQueryOption(v.COMP,"range").withHeader(R.CONTENT_TYPE,"application/octet-stream").withHeader(R.FILE_WRITE,o);if(a.rangeStart=n,a.rangeEnd=s,O.setHeaders(l,a),o===y.RangeWriteOptions.UPDATE){var u=s-n+1;l.withHeader(R.CONTENT_LENGTH,u)}else l.withHeader(R.CONTENT_LENGTH,0);return l},H.prototype._validateLengthAndMD5=function(e,t){var n,s=t.response.headers[S.HeaderConstants.CONTENT_MD5];d.objectIsNull(t.response.headers[S.HeaderConstants.CONTENT_LENGTH])||(n=parseInt(t.response.headers[S.HeaderConstants.CONTENT_LENGTH],10)),d.objectIsNull(e.disableContentMD5Validation)&&(e.disableContentMD5Validation=!1),!1===e.disableContentMD5Validation&&!0===e.useTransactionalMD5&&d.objectIsNull(s)&&(t.error=new Error(p.MD5_NOT_PRESENT_ERROR),t.retryable=!1),d.objectIsNull(t.length)&&("string"==typeof t.response.body?t.length=r.byteLength(t.response.body):r.isBuffer(t.response.body)&&(t.length=t.response.body.length)),d.objectIsNull(n)||t.length===n||(t.error=new Error(p.CONTENT_LENGTH_MISMATCH),t.retryable=!1),!1===e.disableContentMD5Validation&&d.objectIsNull(t.contentMD5)&&(t.contentMD5=d.getContentMd5(t.response.body)),!1!==e.disableContentMD5Validation||d.objectIsNull(s)||s===t.contentMD5||(t.error=new Error(o.format(p.HASH_MISMATCH,s,t.contentMD5)),t.retryable=!1)},H.prototype._doesFileExist=function(e,t,r,n,s,o){var a;d.normalizeArgs(s,o,function(e,t){a=e,o=t}),h.validateArgs("FileExists",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var l=i(!0,{},a),u=D(e,t,r),c=m.head(u).withQueryOption(v.SHARE_SNAPSHOT,l.shareSnapshotId);this.performRequest(c,null,l,function(n,s){n.fileResult=new O(e,t,r),n.error?n.error&&n.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(n.error=null,n.fileResult.exists=!1,n.response.isSuccessful=!0):(n.fileResult.exists=!0,n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){o(e.error,e.fileResult,e.response)})})},H.prototype._doesDirectoryExist=function(e,t,r,n,s){var o;d.normalizeArgs(n,s,function(e,t){o=e,s=t}),h.validateArgs("directoryExists",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(s)});var a=i(!0,{},o),l=m.head(D(e,t)).withQueryOption(v.RESTYPE,"directory").withQueryOption(v.SHARE_SNAPSHOT,a.shareSnapshotId),u=this;this.performRequest(l,null,a,function(e,r){e.directoryResult=new C(t),e.directoryResult.exists=!1,e.error?e.error&&e.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(e.error=null,e.response.isSuccessful=!0):(e.directoryResult.exists=!0,e.directoryResult.metadata=u.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){s(e.error,e.directoryResult,e.response)})})},H.prototype._doesShareExist=function(e,t,r,n){var s;d.normalizeArgs(r,n,function(e,t){s=e,n=t}),h.validateArgs("shareExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(n)});var o=i(!0,{},s),a=m.head(e).withQueryOption(v.RESTYPE,"share").withQueryOption(v.SHARE_SNAPSHOT,o.shareSnapshotId);this.performRequest(a,null,o,function(t,r){t.shareResult=new w(e),t.shareResult.exists=!1,t.error?t.error&&t.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(t.error=null,t.response.isSuccessful=!0):(t.shareResult.exists=!0,t.shareResult.getPropertiesFromHeaders(t.response.headers));r(t,function(e){n(e.error,e.shareResult,e.response)})})},H.SpeedSummary=f,t.exports=H}).call(this,e("buffer").Buffer)},{"../../common/errors/errors":8,"./../../common/common.core":6,"./../../common/md5-wrapper":13,"./internal/filerangestream":53,"./models/directoryresult":54,"./models/fileresult":55,"./models/shareresult":56,buffer:"buffer",extend:158,path:191,querystring:208,underscore:249,url:250,util:"util"}],191:[function(e,t,r){(function(e){function t(e,t){for(var r=0,n=e.length-1;n>=0;n--){var s=e[n];"."===s?e.splice(n,1):".."===s?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,s=function(e){return n.exec(e).slice(1)};function o(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}r.resolve=function(){for(var r="",n=!1,s=arguments.length-1;s>=-1&&!n;s--){var a=s>=0?arguments[s]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(r=a+"/"+r,n="/"===a.charAt(0))}return r=t(o(r.split("/"),function(e){return!!e}),!n).join("/"),(n?"/":"")+r||"."},r.normalize=function(e){var n=r.isAbsolute(e),s="/"===a(e,-1);return(e=t(o(e.split("/"),function(e){return!!e}),!n).join("/"))||n||(e="."),e&&s&&(e+="/"),(n?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(o(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},r.relative=function(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=r.resolve(e).substr(1),t=r.resolve(t).substr(1);for(var s=n(e.split("/")),o=n(t.split("/")),a=Math.min(s.length,o.length),i=a,l=0;l<a;l++)if(s[l]!==o[l]){i=l;break}var u=[];for(l=i;l<s.length;l++)u.push("..");return(u=u.concat(o.slice(i))).join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){var t=s(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},r.basename=function(e,t){var r=s(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},r.extname=function(e){return s(e)[3]};var a="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,e("_process"))},{_process:198}],56:[function(e,t,r){var n=e("./../../../common/common.core"),s=n.util,o=n.Constants.HeaderConstants;function a(e){this.name=e}a.parse=function(e,t){var r=new a(t);for(var n in e)if(e.hasOwnProperty(n))if("Properties"===n)s.setPropertyValueFromXML(r,e[n],!0);else if("Metadata"===n||"ShareStats"===n){var o=s.normalizePropertyNameFromXML(n);r[o]={},s.setPropertyValueFromXML(r[o],e[n],"ShareStats"===n)}else r[n.toLowerCase()]=e[n];return r},a.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,n){!t[r]&&e[n.toLowerCase()]&&(t[r]=e[n.toLowerCase()])};r("etag",o.ETAG),r("lastModified",o.LAST_MODIFIED),r("requestId",o.REQUEST_ID),r("quota",o.SHARE_QUOTA)},t.exports=a},{"./../../../common/common.core":6}],55:[function(e,t,r){var n=e("underscore"),s=e("./../../../common/common.core"),o=s.util,a=s.Constants.HeaderConstants;function i(e,t,r){this.share=e,this.directory=t,this.name=r}i.parse=function(e){var t=new i;for(var r in e)"Properties"===r?o.setPropertyValueFromXML(t,e[r],!0):t[r.toLowerCase()]=e[r];return t};var l={acceptRanges:"ACCEPT_RANGES",contentLength:"CONTENT_LENGTH",contentRange:"CONTENT_RANGE","contentSettings.contentType":"CONTENT_TYPE","contentSettings.contentEncoding":"CONTENT_ENCODING","contentSettings.contentLanguage":"CONTENT_LANGUAGE","contentSettings.cacheControl":"CACHE_CONTROL","contentSettings.contentDisposition":"CONTENT_DISPOSITION","contentSettings.contentMD5":"CONTENT_MD5","contentSettings.fileContentMD5":"FILE_CONTENT_MD5","copy.id":"COPY_ID","copy.status":"COPY_STATUS","copy.source":"COPY_SOURCE","copy.progress":"COPY_PROGRESS","copy.completionTime":"COPY_COMPLETION_TIME","copy.statusDescription":"COPY_STATUS_DESCRIPTION"};i.prototype.getPropertiesFromHeaders=function(e,t){var r=this,s=function(t,n){if(!o.tryGetValueChain(r,t.split("."),null)&&e[n.toLowerCase()]&&(o.setObjectInnerPropertyValue(r,t.split("."),e[n.toLowerCase()]),"copy.progress"===t)){var s=o.parseCopyProgress(r.copy.progress);r.copy.bytesCopied=parseInt(s.bytesCopied),r.copy.totalBytes=parseInt(s.totalBytes)}};s("contentSettings.contentMD5",a.FILE_CONTENT_MD5),s("etag",a.ETAG),s("lastModified",a.LAST_MODIFIED),s("requestId",a.REQUEST_ID),s("serverEncrypted",a.SERVER_ENCRYPTED),t&&n.chain(l).pairs().each(function(e){var t=e[0],r=a[e[1]];s(t,r)})},i.setHeaders=function(e,t){var r=function(r,n){var s=o.tryGetValueChain(t,n.split("."),null);s&&e.withHeader(r,s)};if(t&&(r(a.CONTENT_MD5,"transactionalContentMD5"),r(a.CONTENT_LENGTH,"contentLength"),!o.objectIsNull(t.rangeStart))){var n="bytes="+t.rangeStart+"-";o.objectIsNull(t.rangeEnd)||(n+=t.rangeEnd),e.withHeader(a.STORAGE_RANGE,n)}},i.setProperties=function(e,t){var r=function(r,n){var s=o.tryGetValueChain(t,n.split("."),null);s&&e.withHeader(r,s)};t&&(r(a.FILE_CONTENT_LENGTH,"contentLength"),r(a.FILE_CONTENT_TYPE,"contentSettings.contentType"),r(a.FILE_CONTENT_ENCODING,"contentSettings.contentEncoding"),r(a.FILE_CONTENT_LANGUAGE,"contentSettings.contentLanguage"),r(a.FILE_CONTENT_DISPOSITION,"contentSettings.contentDisposition"),r(a.FILE_CACHE_CONTROL,"contentSettings.cacheControl"),r(a.FILE_CONTENT_MD5,"contentSettings.contentMD5"),t.metadata&&e.addOptionalMetadataHeaders(t.metadata))},t.exports=i},{"./../../../common/common.core":6,underscore:249}],54:[function(e,t,r){var n=e("./../../../common/common.core").Constants.HeaderConstants;function s(e){this.name=e}s.parse=function(e){return new s(e.Name)},s.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,n){!t[r]&&e[n.toLowerCase()]&&(t[r]=e[n.toLowerCase()])};r("etag",n.ETAG),r("lastModified",n.LAST_MODIFIED),r("requestId",n.REQUEST_ID),r("serverEncrypted",n.SERVER_ENCRYPTED)},t.exports=s},{"./../../../common/common.core":6}],53:[function(e,t,r){var n=e("util"),s=e("./../../../common/streams/rangestream"),o=e("./../../../common/util/constants");function a(e,t,r,n,s){a.super_.call(this,e,null,null,s),this._lengthHeader=o.HeaderConstants.FILE_CONTENT_LENGTH,s.minRangeSize?this._minRangeSize=s.minRangeSize:this._minRangeSize=o.FileConstants.MIN_WRITE_FILE_SIZE_IN_BYTES,s.maxRangeSize?this._maxRangeSize=s.maxRangeSize:this._maxRangeSize=o.FileConstants.DEFAULT_WRITE_SIZE_IN_BYTES,this._listFunc=e.listRanges,this._resourcePath.push(t),this._resourcePath.push(r),this._resourcePath.push(n)}n.inherits(a,s),t.exports=a},{"./../../../common/streams/rangestream":30,"./../../../common/util/constants":33,util:"util"}]},{},[2]);
